#!/usr/bin/expect
set cmd [lindex $argv 0]
set login [lindex $argv 1]
set server [lindex $argv 2]
set port [lindex $argv 3]

set serverpass "dgjujytpfrhjkbrjv"
set env(TERM) vt100
set timeout 30
set i 0
spawn /usr/bin/ssh $server $port

expect {
"*yes/no*" {
send "yes\r"
} timeout {
exit 2
} "*password*" {
send "$serverpass\r"
set i 1
}
}

if { $i != 1 } {
expect "*password*"
send "$serverpass\r"
}

expect {
"# *" {
send "$cmd $login\r"
expect -re "(.*)\r\n"
expect -re "(.*)\r\n"
set acc $expect_out(1,string)
expect "closed*"
} timeout {
exit 2
}
}

set file [open "/usr/apache/htdocs/openvpn.ru/confs/confs2/lastlock" w]
puts $file "<b>$acc</b><br><br>"
close $file


exit 0
