#!/usr/bin/perl

$account=shift;
$type=shift;
exit print "Parameters?\n" unless $account;
use IO::Socket;
$|++;
    @variants=`find /usr/local/etc -name \'password\'`;
    foreach $var (@variants) {
        chomp $var;
        open (BASE,$var);
            while ($log=<BASE>) {
                $true=$log;
                chomp $log;
                ($log,$salt)=split(':',$log);
                if ($log eq $account) {
                        $var=~s/password$/openvpn.conf/;
                        $management=`cat $var | grep \'127.0.0.1\'`;
                        chomp $management;
                        (undef,$port)=split('127.0.0.1 ',$management);
                        $kill=IO::Socket::INET->new("127.0.0.1:$port") || exit "Cant connect for killing\n";
                        $kill->autoflush(1);
                        $recv=<$kill>;
                        print $kill "kill $account\r\n";
                        $recv=<$kill>;
                        if ($recv=~/ERROR/) { print "Not found online!!\n";
                        } else { print "Turned offline\n"; }
                        close($kill);
                        exit;
                }
            }
    }
 print "Account not found!\n";
