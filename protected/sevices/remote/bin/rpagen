#!/usr/bin/expect
set server [lindex $argv 0]
set port [lindex $argv 1]
set serverpass "dgjujytpfrhjkbrjv"
set env(TERM) vt100
set i 0
set timeout 30
puts "connect to $server"
set sserver "multi@$server"
spawn /usr/bin/ssh $sserver $port

expect {
"*yes/no*" {
send "yes\r"
} timeout {
exit 2
} "*password*" {
send "$serverpass\r"
set i 1
}
}

if { $i != 1 } {
expect "*password*"
send "$serverpass\r"
}

expect "# *"
send "pagen $server\r"
expect -re "(.*)\n"
expect -re "(.*)\r\n"
set acc $expect_out(1,string)
expect "closed*"

set file [open "/usr/apache/htdocs/openvpn.ru/confs/confs2/pptp" w]
foreach req [split $acc ";"] {
puts $file "$req"
}
close $file
exit 0
