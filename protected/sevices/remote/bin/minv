#!/usr/bin/expect

set env(TERM) vt100
set serverpass "dgjujytpfrhjkbrjv"
set sserver(4) "usa-wc-silver.openvpn.ru"
set sserver(5) "cz-cas.openvpn.ru"
set sserver(6) "de-gold.openvpn.ru"
set sserver(8) "uk-bronze.openvpn.ru"
set sserver(9) "bg-bronze.openvpn.ru"
set sserver(13) "prx.openvpn.ru"
set sserver(15) "tr.openvpn.ru"
set sserver(16) "lux1.openvpn.ru"



set timeout 80

exec /usr/local/etc/bin/inv 1
foreach serv [array names sserver] {
set port ""
set i 0
puts "connect to $sserver($serv)"


spawn /usr/bin/ssh multi@$sserver($serv) $port

expect {
"*yes/no*" {
send "yes\r"
} timeout {
exit 2
} "*password*" {
send "$serverpass\r"
set i 1
}
}

if { $i != 1 } {
expect "*password*"
send "$serverpass\r"
}

expect "# *"
send "inv\r"
expect -re "(.*)\r\n"
expect "closed*"
}
exit 0
